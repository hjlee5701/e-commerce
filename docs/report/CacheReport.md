# ✅ Redis 캐싱 적용 결과 보고서
## 1️⃣ 개요
- 인기 판매 상품 조회 API에 Redis 캐싱을 적용하여 성능을 개선합니다.
- 캐시 적용 전후의 성능 테스트를 통해 응답 시간, 처리 효율을 비교 분석합니다.

## 2️⃣ 캐시 도입 배경과 적용
### 2-1. 도입 배경
- 하루 단위로 스케줄러를 통해 상품 판매 데이터를 집계하고, 사용자 요청 시 3일간의 인기 상품(최대 5개)을 제공합니다.
- 단순 조회임에도 매 요청마다 DB 집계 쿼리가 수행되어 응답 속도가 느려지고, 사용자 경험이 저하되는 문제가 발생했습니다.

### 2-2. 적용 이유
- 집계 데이터는 하루에 한 번만 갱신되므로, Redis에 캐싱하기 적합합니다.
- 메인 화면 접근 시마다 API 호출이 발생하므로, 빈번한 조회에 대한 빠른 응답이 필요합니다.

### 2-3. 적용 항목
- 집계 스케줄러 실행 시, 인기 상품의 ID 리스트를 Redis에 저장합니다.
- API에서는 캐시된 ID 리스트를 기준으로 DB에서 해당 상품의 상세 정보를 조회합니다.

## 3️⃣ 캐시 전략
1. 상품 아이디 캐시

    | 항목       | 내용                                                |
    | -------- | ------------------------------------------------- |
    | 전략 유형    | **Look Aside (Cache-Aside)**                      |
    | 캐시 Key   | `PopularProductIds:{startDate}:{endDate}:{count}` |
    | 캐시 Value | 인기 상품의 **ID 리스트** (최대 5개)                         |
    | TTL      | 30시간 (다음날 유효성 확보)                                 |
    | 저장 시점    | **스케줄러 실행 시점**, 1일 1회 갱신                          |

2. 상품 정보 캐시

    | 항목       | 내용                               |
    | -------- |----------------------------------|
    | 전략 유형    | **Look Aside (Cache-Aside)**     |
    | 캐시 Key   | `Ranking:{startDate}:{endDate}:{count}` |
    | 캐시 Value | 인기 상품의 리스트 (최대 5개)               |
    | TTL      | 30시간 (다음날 유효성 확보)                |
    | 저장 시점    | **스케줄러 실행 시점**, 1일 1회 갱신         |
> 조회 시점이 아닌, 집계 완료 시점에 캐시를 저장하여 사용자 요청 시 즉시 응답이 가능하도록 구성했습니다.

## 4️⃣ 캐시 갱신 정책 (Eviction)
- 기존 캐시는 스케줄러 실행 시 자동 overwrite됩니다.
- TTL(30시간)을 설정해 이중 만료 메커니즘을 구성, 예기치 않은 캐시 누락도 방지합니다.

## 5️⃣ 상품 아이디 캐시 :: 데이터 양에 따른 성능 테스트 결과
###  5-1. 테스트 조건
a. 상품 아이디 캐시 

b. 조회 대상 상품 수에 따라 성능 차이를 확인

c. 총 5회 반복 측정, ms 단위로 응답 시간 기록

d. 테스트 환경: 동일 DB, 동일 인프라 조건


### Case 1: 당일 판매 상품 수 50개
| 회차     | 캐시 미적용 | 캐시 적용 |
| ------ | ------ | ----------- |
| 1      | 1450 ms | 93 ms       |
| 2      | 1239 ms | 20 ms       |
| 3      | 1219 ms | 28 ms       |
| 4      | 1251 ms | 27 ms       |
| 5      | 1214 ms | 15 ms       |
| **평균** | **1274.6 ms** | **28.9 ms** |


>  약 97.7% 응답 시간 단축, 약 45배 성능 향상

###  Case 2: 당일 판매 상품 수 50,000개
| 회차     | 캐시 미적용        | 캐시 적용       |
| ------ | ------------- | ----------- |
| 1      | 1831 ms       | 157 ms      |
| 2      | 1512 ms       | 15 ms       |
| 3      | 1475 ms       | 23 ms       |
| 4      | 1443 ms       | 13 ms       |
| 5      | 1754 ms       | 20 ms       |
| **평균** | **1603.0 ms** | **45.6 ms** |

> 약 97.2% 응답 시간 단축, 약 35배 성능 향상

- 상품 아이디 캐시를 적용했지만, 조회 API 에서 DB 를 거쳐갈 수 밖에 없다.
- 따라서 동시에 많은 요청이 들어온 경우, 캐시를 적용한 것과 별개로 성능상 이점을 볼 수 없었다.

## 6️⃣ 상품 캐시 :: 부하 테스트 결과
###  6-1. 테스트 조건
a. 상품 캐시

b. 조회 대상 상품 수에 따라 성능 차이를 확인

c. 총 5회 반복 측정, ms 단위로 응답 시간 기록

d. 테스트 환경: 동일 DB, 동일 인프라 조건

| **항목**             | **설명**                                       | **값**                                    |
| ------------------ | -------------------------------------------- | ---------------------------------------- |
| **테스트 시나리오**       | **지속 부하(sustained load)**, 일정한 요청 속도로 테스트 수행 | 1000 RPS (초당 요청 수)                       |
| **테스트 기간**         | 테스트가 진행되는 총 시간                               | 3분 (180초)                                |
| **초기 할당된 VU 수**    | 최소 가상 사용자 수 (VU)                             | 1000 VUs                                 |
| **최대 VU 수**        | 최대 가상 사용자 수                                  | 1200 VUs                                 |
| **테스트 URL**        | 캐시된 상품 정보를 조회하는 API URL                      | `http://localhost:8080/products/popular` |
| **응답 상태 코드**       | 각 요청에 대한 상태 코드 확인                            | 200 OK (정상 응답)                           |
| **응답 시간 기준**       | 각 요청의 응답 시간이 100ms 이하인지 확인                   | `response time < 100ms`                  |
| **사용된 요청 메소드**     | 요청에 사용된 HTTP 메소드                             | GET (HTTP GET 요청)                        |
| **실패 요청**          | 상태 코드가 200이 아닌 요청 수                          | 기록 없음 (정상 응답만 고려)                        |
| **응답 시간**          | 각 요청에 대해 측정된 응답 시간                           | 응답 시간 평균 2.89ms                          |
| **응답 시간 분포**       | 응답 시간 100ms 초과 비율                            | 7건 (99% 이하 응답)                           |
| **응답 시간 분포 (90%)** | 90% 응답 시간이 소요되는 시간                           | 3.9ms                                    |
| **응답 시간 분포 (95%)** | 95% 응답 시간이 소요되는 시간                           | 4.64ms                                   |


---
## 6️⃣ 결론
- Redis 캐싱을 통해 정적인 통계 데이터에 대한 반복 쿼리 비용을 완전히 제거할 수 있었습니다.
- 캐시 적용 후 평균 응답 속도가 수십 배 향상되었고, 특히 대용량 데이터 조건에서도 안정적 성능을 유지하였습니다.
- 사용자 경험, 시스템 부하, 응답 안정성 측면에서 모두 유의미한 개선이 이루어졌습니다.

### ✅ 향후 개선 방향
- Redis MGET 또는 product 캐시 전략 도입으로 추가 병목 제거